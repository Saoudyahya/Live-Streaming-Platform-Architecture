# config/srs-optimized.conf
listen              1935;
max_connections     50000;
srs_log_tank        file;
srs_log_level       warn;
daemon              on;
utc_time            off;
work_dir            ./;
pid                 ./objs/srs.pid;

# Optimized settings
tcp_nodelay         on;
send_min_interval   10.0;
reduce_sequence_header on;

# HTTP server
http_server {
    enabled         on;
    listen          8080;
    dir             ./objs/nginx/html;
    crossdomain     on;
}

# HTTP API
http_api {
    enabled         on;
    listen          1985;
    crossdomain     on;
}

# High-performance streaming
vhost __defaultVhost__ {
    # Optimized GOP cache
    gop_cache       on;
    gop_cache_max_frames 2500;
    
    # Queue optimization
    queue_length    30;
    
    # HLS with minimal latency
    hls {
        enabled         on;
        hls_fragment    2;
        hls_window      6;
        hls_path        ./objs/nginx/html/hls;
        hls_m3u8_file   [app]/[stream].m3u8;
        hls_ts_file     [app]/[stream]-[seq].ts;
        hls_cleanup     on;
        hls_dispose     30;
    }
    
    # High-performance recording
    dvr {
        enabled      on;
        dvr_path     ./objs/nginx/html/recordings/[app]/[stream].[timestamp].mp4;
        dvr_plan     session;
        dvr_duration 30;
        dvr_wait_keyframe on;
        time_jitter  full;
    }
}